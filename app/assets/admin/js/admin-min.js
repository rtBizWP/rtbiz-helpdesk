/*! 
 * rtBiz Helpdesk JavaScript Library 
 * @package rtBiz Helpdesk 
 */jQuery(document).ready(function(){var a,b={rthd_tinymce_set_content:function(a,b){if("undefined"!=typeof tinymce){var c=tinymce.get(a);return c&&c instanceof tinymce.Editor?(c.setContent(b),c.save({no_events:!0})):jQuery("#"+a).val(b),!0}return!1},rthd_tinymce_get_content:function(a){if("undefined"!=typeof tinymce){var b=tinymce.get(a);return b&&b instanceof tinymce.Editor?b.getContent():jQuery("#"+a).val()}return""},init:function(){b.initDatePicket(),b.initDateTimePicker(),b.initMomentJS(),b.initattchmentJS(),b.initExternalFileJS(),b.initSubscriberSearch(),b.initAddNewFollowUp(),b.initEditFollowUp(),b.initLoadAll(),b.initEditContent(),b.initAutoResponseSettings(),b.initBlacklistConfirmationOrRemove(),b.initAddContactBlacklist()},initEditContent:function(){jQuery(".edit-ticket-link").click(function(a){a.preventDefault(),jQuery("#edit-ticket-data").slideToggle("slow"),jQuery("#dialog-form").is(":visible")&&jQuery("#dialog-form").slideToggle("slow"),jQuery("#edit-ticket-data").is(":visible")||jQuery("#edit-ticket-data").slideToggle("slow"),jQuery("#new-followup-form").hide(),jQuery(document).scrollTop(jQuery("#edit-ticket-data").offset().top-50),b.rthd_tinymce_set_content("editedticketcontent",jQuery(this).closest(".ticketcontent").find(".rthd-comment-content").data("content"))}),jQuery(".close-edit-content").click(function(a){a.preventDefault(),jQuery("#edit-ticket-data").slideToggle("slow"),jQuery("#new-followup-form").show(),jQuery(document).scrollTop(jQuery(".ticketcontent").offset().top-50)}),jQuery("#edit-ticket-content-click").click(function(){jQuery("#edit-ticket-data").slideToggle("slow"),jQuery("#new-followup-form").hide();var a=new Object;a.action="rthd_add_new_ticket_ajax",a.post_id=jQuery("#post-id").val();var c=b.rthd_tinymce_get_content("editedticketcontent");a.body=c,a.nonce=jQuery("#edit_ticket_nonce").val(),jQuery("#ticket-edithdspinner").show(),jQuery(this).attr("disabled","disabled"),jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:a,success:function(a){a.status?(jQuery("#ticket-edithdspinner").hide(),jQuery("#edit-ticket-content-click").removeAttr("disabled"),jQuery(".edit-ticket-link").closest(".ticketcontent").find(".rthd-comment-content").html(b.rthd_tinymce_get_content("editedticketcontent")),jQuery("#edit-ticket-data").hide(),jQuery("#new-followup-form").slideToggle("slow"),jQuery(document).scrollTop(jQuery(".ticketcontent").offset().top-50)):console.log(a.msg)},error:function(a,b,c){alert("Error"),jQuery("#ticket-edithdspinner").hide(),jQuery("#edit-ticket-content-click").removeAttr("disabled")}})})},initLoadAll:function(){jQuery("#followup-load-more, .load-more-block").click(function(a){a.preventDefault();var b=new Object,c=parseInt(jQuery("#followup-totalcomment").val(),10),d=parseInt(jQuery("#followup-limit").val(),10);3==d&&(jQuery(this).parent().hide(),jQuery("#load-more-hdspinner").show(),b.limit=c-3,b.offset=0,b.action="load_more_followup",b.post_id=jQuery("#post-id").val(),jQuery.ajax({url:ajaxurl,dataType:"json",type:"post",data:b,success:function(a){a.status&&(jQuery("#followup-offset").val(a.offset),jQuery("#chat-UI").prepend(a.comments)),jQuery("#load-more-hdspinner").hide()},error:function(){return jQuery("#load-more-hdspinner").hide(),!1}}))})},initEditFollowUp:function(){var a;jQuery("#delfollowup").click(function(){var b=confirm("Are you sure you want to remove this Followup?");return 1!=b?(e.preventDefault(),!1):(jQuery("#edithdspinner").show(),jQuery(this).attr("disabled","disabled"),postid=jQuery("#post-id").val(),void jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"helpdesk_delete_followup",comment_id:a,post_id:postid},success:function(b){b.status?(jQuery("#comment-"+a).fadeOut(500,function(){jQuery(this).remove()}),jQuery(".close-edit-followup").trigger("click")):alert("Error while deleting comment from server"),jQuery("#edithdspinner").hide(),jQuery("#delfollowup").removeAttr("disabled")},error:function(a,b,c){alert("error while removing follow up."),jQuery("#edithdspinner").hide(),jQuery("#delfollowup").removeAttr("disabled")}}))}),jQuery(document).on("click",".close-edit-followup",function(b){b.preventDefault(),jQuery("#dialog-form").slideToggle("slow"),jQuery("#new-followup-form").show(),jQuery(document).scrollTop(jQuery("#comment-"+a).offset().top)}),jQuery(document).on("click",".editfollowuplink",function(c){c.preventDefault();var d=jQuery(this).parents();b.rthd_tinymce_set_content("editedfollowupcontent",jQuery(this).parents().siblings(".rthd-comment-content").data("content")),a=d.siblings("#followup-id").val();var e=d.siblings("#is-private-comment").val();jQuery("#edit-private").val(e),jQuery("#new-followup-form").hide(),jQuery("#dialog-form").is(":visible")||jQuery("#dialog-form").slideToggle("slow"),jQuery("#edit-ticket-data").is(":visible")&&jQuery("#edit-ticket-data").slideToggle("slow"),jQuery(document).scrollTop(jQuery("#dialog-form").offset().top-50)}),jQuery("#editfollowup").click(function(){var c=new Object,d=b.rthd_tinymce_get_content("editedfollowupcontent");return d?d.replace(/\s+/g," ")===jQuery("#comment-"+a).find(".rthd-comment-content").data("content")?(alert("You have not edited comment!"),!1):(jQuery("#edithdspinner").show(),jQuery(this).attr("disabled","disabled"),c.post_type=rthd_post_type,c.comment_id=a,c.action="rthd_update_followup_ajax",c.followuptype="comment",c.followup_ticket_unique_id=jQuery("#ticket_unique_id").val(),c.followup_post_id=jQuery("#post-id").val(),c.followup_private=jQuery("#edit-private").val(),c.followuptype="comment",c.followup_content=d,void jQuery.ajax({url:ajaxurl,dataType:"json",type:"post",data:c,success:function(b){b.status?(jQuery("#comment-"+a).replaceWith(b.comment_content),jQuery(".close-edit-followup").trigger("click"),jQuery(document).scrollTop(jQuery("#comment-"+a).offset().top-50)):alert(b.message),jQuery("#edithdspinner").hide(),jQuery("#editfollowup").removeAttr("disabled")},error:function(a){alert("Sorry :( something went wrong!"),jQuery("#edithdspinner").hide(),jQuery("#editfollowup").removeAttr("disabled")}})):(alert("Please enter comment"),!1)})},initAddNewFollowUp:function(){function a(){return jQuery("#hdspinner").show(),jQuery("#ticket_unique_id").val()?b.rthd_tinymce_get_content("followupcontent")?!0:(alert("Please input followup."),jQuery("#hdspinner").hide(),!1):(alert("Please publish ticket before adding followup! :( "),jQuery("#hdspinner").hide(),!1)}function c(a){var c=(jQuery("#followup-type").val(),new FormData);c.append("private_comment",jQuery("#add-private-comment").val()),c.append("followup_ticket_unique_id",jQuery("#ticket_unique_id").val()),c.append("post_type",jQuery("#followup_post_type").val()),c.append("action","rthd_add_new_followup_front"),c.append("followuptype",jQuery("#followuptype").val()),c.append("follwoup-time",jQuery("#follwoup-time").val()),c.append("followup_content",b.rthd_tinymce_get_content("followupcontent")),c.append("followup_attachments",d),jQuery("#rthd_keep_status")&&c.append("rthd_keep_status",jQuery("#rthd_keep_status").is(":checked")),jQuery.ajax({url:ajaxurl,dataType:"json",type:"POST",data:c,cache:!1,contentType:!1,processData:!1,success:function(a){a.status?(jQuery("#chat-UI").append(a.comment_content),b.rthd_tinymce_set_content("followupcontent",""),jQuery("#add-private-comment").val(10),d=[],"answered"==a.ticket_status?jQuery("#rthd_keep_status")&&jQuery("#rthd_keep_status").parent().hide():jQuery("#rthd_keep_status").length>0&&jQuery("#rthd_keep_status").prop("checked",!1),jQuery("#hdspinner").hide(),jQuery("#savefollwoup").removeAttr("disabled")):(console.log(a.message),jQuery("#hdspinner").hide(),jQuery("#savefollwoup").removeAttr("disabled"))}})}$ticket_unique_id=jQuery("#ticket_unique_id").val();var d=[],e=!1;if("undefined"!=typeof plupload){var f=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"attachemntlist",url:ajaxurl,multipart:!0,multipart_params:{action:"rthd_upload_attachment",followup_ticket_unique_id:$ticket_unique_id},container:document.getElementById("rthd-attachment-container"),filters:{max_file_size:"10mb"},flash_swf_url:"Moxie.swf",silverlight_xap_url:"Moxie.xap",init:{PostInit:function(){document.getElementById("followup-filelist").innerHTML="",document.getElementById("savefollwoup").onclick=function(){a()&&f.start()}},FilesAdded:function(a,b){plupload.each(b,function(a){document.getElementById("followup-filelist").innerHTML+='<div id="'+a.id+'"><a href="#" class="followup-attach-remove"> x </a> '+a.name+" ("+plupload.formatSize(a.size)+") <b></b></div>"})},FilesRemoved:function(a,b){plupload.each(b,function(a){jQuery("#"+a.id).remove()})},UploadProgress:function(a,b){document.getElementById(b.id).getElementsByTagName("b")[0].innerHTML="<span>"+b.percent+"%</span>"},Error:function(a,b){document.getElementById("console").innerHTML+="\nError #"+b.code+": "+b.message},UploadComplete:function(){document.getElementById("followup-filelist").innerHTML="",c(e),e=!1,d=[]},FileUploaded:function(a,b,c){var e=jQuery.parseJSON(c.response);e.status&&(d=d.concat(e.attach_ids))}}});f.init()}jQuery(document).on("click",".followup-attach-remove",function(a){a.preventDefault(),f.removeFile(jQuery(this).parent().attr("id"))})},initDatePicket:function(){jQuery(".datepicker").length>0&&jQuery(".datepicker").datepicker({dateFormat:"M d,yy",onClose:function(a,b){if(jQuery(this).hasClass("moment-from-now")){var c=jQuery(this).attr("title");""!=a&&moment(a).isValid()?(jQuery(this).val(moment(new Date(a)).fromNow()),jQuery(this).attr("title",a),jQuery(this).next().length>0&&jQuery(this).next().val(a)):""!=c&&(jQuery(this).val(moment(new Date(c)).fromNow()),jQuery(this).attr("title",c),jQuery(this).next().length>0&&jQuery(this).next().val(a))}}}),jQuery(".datepicker-toggle").click(function(a){jQuery("#"+jQuery(this).data("datepicker")).datepicker("show")})},initDateTimePicker:function(){jQuery(".datetimepicker").length>0&&jQuery(".datetimepicker").datetimepicker({dateFormat:"M d, yy",timeFormat:"hh:mm TT",onClose:function(a,b){var c=jQuery(this).attr("title");""!=a&&moment(a).isValid()&&(jQuery(this).val(moment(new Date(a)).fromNow()),jQuery(this).attr("title",a),jQuery(this).next().length>0?jQuery(this).hasClass("moment-from-now")&&jQuery(this).next().val(a):""!=c&&(jQuery(this).val(moment(new Date(c)).fromNow()),jQuery(this).attr("title",c),jQuery(this).next().length>0&&jQuery(this).next().val(a)))}})},initMomentJS:function(){jQuery(document).on("click",".moment-from-now",function(a){var b=jQuery(this).attr("title");""!=b&&jQuery(this).datepicker("setDate",new Date(jQuery(this).attr("title")))}),jQuery(".moment-from-now").each(function(){jQuery(this).is("input[type='text']")&&""!=jQuery(this).val()?jQuery(this).val(moment(new Date(jQuery(this).attr("title"))).fromNow()):jQuery(this).html(jQuery(this).is(".comment-date")?moment(new Date(jQuery(this).attr("title"))).fromNow():moment(new Date(jQuery(this).html())).fromNow())})},initattchmentJS:function(){jQuery(document).on("click",".rthd_delete_attachment",function(a){a.preventDefault(),jQuery(this).parent().remove()}),jQuery("#add_ticket_attachment").on("click",function(b){return b.preventDefault(),a?void a.open():(a=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),searchable:!0,button:{text:"Attach Selected Files"},multiple:!0}),a.on("select",function(){var b=a.state().get("selection"),c="";b.map(function(a){a=a.toJSON(),c='<li data-attachment-id="'+a.id+'" class="attachment-item row_group">',c+='<a href="#" class="delete_row rthd_delete_attachment">x</a>',c+='<a target="_blank" href="'+a.url+'"><img height="20px" width="20px" src="'+a.icon+'" > '+a.filename+"</a>",c+='<input type="hidden" name="attachment[]" value="'+a.id+'" /></div>',jQuery("#attachment-container .scroll-height").append(c)})}),void a.open())})},initExternalFileJS:function(){var a=12345;jQuery("#add_new_ex_file").click(function(b){var c=jQuery("#add_ex_file_title").val(),d=jQuery("#add_ex_file_link").val();if(""==jQuery.trim(d))return!1;jQuery("#add_ex_file_title").val(""),jQuery("#add_ex_file_link").val("");var e='<div class="row_group">';e+='<button class="delete_row removeMeta"><i class="foundicon-minus"></i>X</button>',e+='<input type="text" name="ticket_ex_files['+a+'][title]" value="'+c+'" />',e+='<input type="text" name="ticket_ex_files['+a+'][link]" value="'+d+'" />',e+="</div>",a++,jQuery("#external-files-container").append(e)})},initSubscriberSearch:function(){try{void 0!=arr_subscriber_user&&(jQuery("#subscriber_user_ac").autocomplete({source:function(a,b){var c=jQuery.ui.autocomplete.escapeRegex(a.term),d=new RegExp("^"+c,"i"),e=jQuery.grep(arr_subscriber_user,function(a){return d.test(a.label||a.value||a)}),f=new RegExp(c,"i"),g=jQuery.grep(arr_subscriber_user,function(a){return jQuery.inArray(a,e)<0&&f.test(a.label||a.value||a)});b(e.concat(g))},focus:function(a,b){},select:function(a,b){return jQuery("#subscribe-auth-"+b.item.id).length<1&&jQuery("#divSubscriberList").append("<li id='subscribe-auth-"+b.item.id+"' class='contact-list' >"+b.item.imghtml+"<a href='#removeSubscriber' class='delete_row'>×</a><br/><a class='subscribe-title heading' target='_blank' href='"+b.item.user_edit_link+"'>"+b.item.label+"</a><input type='hidden' name='subscribe_to[]' value='"+b.item.id+"' /></li>"),jQuery("#subscriber_user_ac").val(""),!1}}).data("ui-autocomplete")._renderItem=function(a,b){return jQuery("<li></li>").data("ui-autocomplete-item",b).append("<a class='ac-subscribe-selected'>"+b.imghtml+"&nbsp;"+b.label+"</a>").appendTo(a)},jQuery(document).on("click","a[href=#removeSubscriber]",function(a){a.preventDefault(),jQuery(this).parent().remove()}))}catch(a){}},initAutoResponseSettings:function(){jQuery("#rthd_enable_auto_response_mode")&&(jQuery(".rthd-dayshift-time-end").change(function(){b.initDayValidation(jQuery(this).parent().parent())}),jQuery(".rthd-dayshift-time-start").change(function(){b.initDayValidation(jQuery(this).parent().parent())}),jQuery(".rthd-daynight-am-time-start").change(function(){b.initDayNightValidation(jQuery(this).parent().parent())}),jQuery(".rthd-daynight-am-time-end").change(function(){b.initDayNightValidation(jQuery(this).parent().parent())}),jQuery(".rthd-daynight-pm-time-start").change(function(){b.initDayNightValidation(jQuery(this).parent().parent())}),jQuery(".rthd-daynight-pm-time-end").change(function(){b.initDayNightValidation(jQuery(this).parent().parent())}),jQuery.ajaxPrefilter(function(a,c,d){var e=JSON.stringify(a.data);if(-1!==e.indexOf("action=redux_helpdesk_settings_ajax_save&")){var f=!0;if(0==jQuery("#rthd_enable_auto_response").val())return!0;if(1==jQuery("#rthd_enable_auto_response_mode").val())for(var g=0;7>g;g++){var h=jQuery(".rthd-dayshift-time-start").eq(g).parent().parent();b.initDayValidation(h)||(f=!1)}if(0==jQuery("#rthd_enable_auto_response_mode").val())for(var g=0;7>g;g++){var h=jQuery(".rthd-daynight-am-time-start").eq(g).parent().parent();b.initDayNightValidation(h)||(f=!1)}return f?f:(d.abort(),jQuery(".redux-action_bar input").removeAttr("disabled"),jQuery(document.getElementById("redux_ajax_overlay")).fadeOut("fast"),void jQuery(".redux-action_bar .spinner").fadeOut("fast"))}}))},initDayValidation:function(a){var b=a.find(".rthd-dayshift-time-start").val(),c=a.find(".rthd-dayshift-time-end").val(),d=!0,e=!0;if(-1==b&&-1==c?jQuery(a).next(".rthd-dayshift-error").show().find(".error").removeClass("myerror").html(""):-1==b||-1==c?(jQuery(a).next(".rthd-dayshift-error").show().find(".error").addClass("myerror").html(-1==b?"Please select `Start` time":"Please select `End` time"),d=!1):parseInt(c)<parseInt(b)?(jQuery(a).next(".rthd-dayshift-error").show().find(".error").addClass("myerror").html("Starting Time should be less then ending time"),d=!1):jQuery(a).next(".rthd-dayshift-error").show().find(".error").removeClass("myerror").html(""),d){if(jQuery(a).next(".rthd-dayshift-error").hide(),0==jQuery("#rthd_autoresponse_weekend").val()){for(var f=0;7>f;f++){a=jQuery(".rthd-dayshift-time-start").eq(f).parent().parent();var b=a.find(".rthd-dayshift-time-start").val(),c=a.find(".rthd-dayshift-time-end").val();(-1!=b||-1!=c)&&(e=!1)}e&&(jQuery("#rthd-response-day-error").show().html("please select working time"),d=!1)}}else jQuery("#rthd-response-day-error").hide().html("");return d},initDayNightValidation:function(a){var b=a.find(".rthd-daynight-am-time-start").val(),c=a.find(".rthd-daynight-am-time-end").val(),d=a.find(".rthd-daynight-pm-time-start").val(),e=a.find(".rthd-daynight-pm-time-end").val(),f=!0,g=!0;if(-1==b&&-1==c?jQuery(a).next(".rthd-daynightshift-error").show().find(".am-time-error").removeClass("myerror").html(""):-1==b||-1==c?(jQuery(a).next(".rthd-daynightshift-error").show().find(".am-time-error").addClass("myerror").html(-1==b?"Please select `Start` time":"Please select `End` time"),f=!1):parseInt(c)<parseInt(b)?(jQuery(a).next(".rthd-daynightshift-error").show().find(".am-time-error").addClass("myerror").html("Starting Time should be less then ending time"),f=!1):jQuery(a).next(".rthd-daynightshift-error").show().find(".am-time-error").removeClass("myerror").html(""),-1==d&&-1==e?jQuery(a).next(".rthd-daynightshift-error").show().find(".pm-time-error").removeClass("myerror").html(""):-1==d||-1==e?(jQuery(a).next(".rthd-daynightshift-error").show().find(".pm-time-error").addClass("myerror").html(-1==d?"Please select `Start` time":"Please select `End` time"),f=!1):parseInt(e)<parseInt(d)?(jQuery(a).next(".rthd-daynightshift-error").show().find(".pm-time-error").addClass("myerror").html("Starting Time should be less then ending time"),f=!1):jQuery(a).next(".rthd-daynightshift-error").show().find(".pm-time-error").removeClass("myerror").html(""),f){if(jQuery(a).next(".rthd-daynightshift-error").hide(),0==jQuery("#rthd_autoresponse_weekend").val()){for(var h=0;7>h;h++){a=jQuery(".rthd-daynight-am-time-start").eq(h).parent().parent();var b=a.find(".rthd-daynight-am-time-start").val(),c=a.find(".rthd-daynight-am-time-end").val(),d=a.find(".rthd-daynight-pm-time-start").val(),e=a.find(".rthd-daynight-pm-time-end").val();(-1!=b||-1!=c||-1!=d||-1!=e)&&(g=!1)}g&&(jQuery("#rthd-response-daynight-error").show().html("please select working time"),f=!1)}}else jQuery("#rthd-response-daynight-error").hide().html("");return f},initBlacklistConfirmationOrRemove:function(){jQuery(document).on("click","#rthd_ticket_contacts_blacklist",function(a){a.preventDefault();var b=jQuery(this).data("action"),c=new Object;c.post_id=jQuery("#post-id").val(),"remove_blacklisted"==b?(c.action="rthd_remove_blacklisted_contact",jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:c,success:function(a){a.status&&(jQuery("#contacts-blacklist-container").html("").hide(),jQuery("#contacts-blacklist-action").html(a.addBlacklist_ui).show())},error:function(a,b,c){jQuery("#contacts-blacklist-container").html("Some error with ajax request!!").show()}})):"blacklisted_confirmation"==b&&(c.action="rthd_show_blacklisted_confirmation",jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:c,success:function(a){a.status&&(jQuery("#contacts-blacklist-container").html(a.confirmation_ui).show(),jQuery("#contacts-blacklist-action").hide())},error:function(a,b,c){jQuery("#contacts-blacklist-container").html("Some error with ajax request!!").show()}}))})},initAddContactBlacklist:function(){jQuery(document).on("click","#rthd_ticket_contacts_blacklist_yes",function(a){a.preventDefault();var b=jQuery(this).data("action"),c=new Object;c.post_id=jQuery("#post-id").val(),"blacklisted_contact"==b&&(c.action="rthd_add_blacklisted_contact"),jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:c,success:function(a){a.status&&(jQuery(".confirmation-container").hide(),jQuery("#contacts-blacklist-action").html(a.remove_ui).show())},error:function(a,b,c){jQuery("#contacts-blacklist-container").html("Some error with ajax request!!").show()}})}),jQuery(document).on("click","#rthd_ticket_contacts_blacklist_no",function(a){a.preventDefault(),jQuery("#contacts-blacklist-container").html("").hide(),jQuery("#contacts-blacklist-action").show()})}};b.init()});